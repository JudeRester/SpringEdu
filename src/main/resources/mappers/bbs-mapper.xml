<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    <mapper namespace="com.kh.myapp.bbs.dao.BbsDAO">
    <insert id="write">
    	insert into bbs (bnum, btitle, bname, bcontent) values(bbsnum_seq.nextval, #{bTitle},#{bName},#{bContent})
    </insert>
    
     <select id="view">
    	select BNUM, BTITLE, BNAME, BCDATE, BUDATE, BHIT, BCONTENT FROM bbs where bnum = #{bNum}
    </select>
    
    <select id="list" resultType="BbsDTO"> 
    select bnum, btitle, bname, bhit, bcontent, bcdate, bgroup, bstep, bindent
     from bbs order by bgroup desc, bstep asc 
     </select>
    <update id="update">
    	update BBS SET btitle=#{bTitle}, bname=#{bName}, bcontent=#{bContent}, BUDATE=sysdate where BNUM = #{bNum}
    </update>
    
    <delete id="delete">
    	delete from bbs where bnum = #{bNum}
    </delete>
    
    
   <insert id="reply">
      insert into bbs (bnum, btitle, bname, bcontent, bgroup, bindent)
      values(bbsnum_seq.nextval,#{btitle},#{bname},#{bcontent},#{bgroup},#{bindent})
   </insert>
   
   <select id="preInfo" resultType="BbsDTO">
      select bnum, btitle, bname, bhit, bUdate, bcontent, bgroup, bstep, bindent
      from bbs where bnum = #{bnum}
   </select>
   
   <select id="listPageCri" resultType="BbsDTO">
      select t2.*
      from (select row_number() over (order by bgroup desc, bstep asc) as num, t1.*
      from bbs t1) t2
      where num between #{startRecord} and #{endRecord}
   </select>
   
   <select id="totalRec" resultType="int">
      select count(*) from bbs
   </select>
   
   <select id="listFindCri" resultType="BbsDTO">
      select t2.* from (select row_number() over (order by bgroup desc, bstep asc) as num, t1.*
      from bbs t1 where bnum > 0 and
      
      <choose>
         <when test="option == 'TC'">
            btitle like '%'||#{search}||'%' or bcontent like '%'||#{search}||'%'
         </when>
         <when test="option == 'T'">
            btitle like '%'||#{search}||'%'
         </when>
         <when test="option == 'C'">
            bcontent like '%'||#{search}||'%'
         </when>
         <when test="option == 'W'">
            bname like '%'||#{search}||'%'
         </when>
      <otherwise>
         btitle like '%'||#{search}||'%' or bcontent like '%'||#{search}||'%' or bname like '%'||#{search}||'%'
      </otherwise>
      </choose>
         ) t2 where num between #{startRecord} and #{endRecord}
   
   </select>
   
   <select id="searchTotalRec" resultType="int">
      select count(*) from (select row_number() over (order by bgroup desc, bstep asc) as num, t1.*
      from bbs t1 where bnum > 0 and
      
      <choose>
         <when test="option == 'TC'">
            btitle like '%'||#{search}||'%' or bcontent like '%'||#{search}||'%'
         </when>
         <when test="option == 'T'">
            btitle like '%'||#{search}||'%'
         </when>
         <when test="option == 'C'">
            bcontent like '%'||#{search}||'%'
         </when>
         <when test="option == 'W'">
            bname like '%'||#{search}||'%'
         </when>
      <otherwise>
         btitle like '%'||#{search}||'%' or bcontent like '%'||#{search}||'%' or bname like '%'||#{search}||'%'
      </otherwise>
      </choose>
         ) t2 
   </select>

    </mapper>